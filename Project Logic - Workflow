1️⃣ Modes of Operation

- Two modes: low resolution and high resolution.
* Currently focus on low resolution.


2️⃣ Data Loading and Background Subtraction

For each energy window:
- Load measurements with gas target (M_i) and background measurements (B_i).
- Compute total measurements (M_tot) and total background (B_tot), then compute backround substracted spectra (F_tot = M_tot - B_tot)
- BONUS: Check consistency of measurements and backgrounds for each energy window -> If any measurement deviates by > 20% from the others → raise error/warning.
- Translate counts to DDCS and # channels to electron energy


3️⃣ Data Selection / Cropping

- Each energy window has 256 points. Allow the user to select which portion of the data to plot: Crop from beginning / end (independently for each window)
    * Could be implemented with start_index and end_index for each window / Maybe do it live with scroll bars in the plot (?)


4️⃣ Plotting Results

- Plot Ftot for each energy window.
- Provide options to the user:
    1) Save figure as image
    2) Save data as text file


5️⃣ Data Averaging

- Allow averaging over N points, where N is user-defined.
* Multiple N values can be used for different energy ranges.


~ Basic functions ~

1) load_data() → load measurement and background files
2) check_consistency() → check for >20% deviations
3) Final() → compute Ftot
4) DDCS() → translate counts to DDCS
5) Ecal()  → translate channels to electron energy 
6) crop_data() → crop each window according to user selection
7) average_data() → perform N-point averaging
8) plot_results() → plot and save images/data

Update Summary (13/12/2025)
1. Robust file parsing and stability fixes
   - Fixed a critical parsing issue caused by an incorrectly escaped whitespace separator (r'\\s+' → r'\s+').
   - Explicitly enforced the Python parsing engine in pandas.read_csv to avoid ambiguity with regex separators.
   - Ensured all input TXT files with three columns are read reliably, independent of spacing or tab usage.
   - Eliminated misleading ParserWarning and FutureWarning messages.

2. Safe numerical handling (division by zero)
   -Removed RuntimeWarning: invalid value encountered in divide by replacing np.where-based logic with explicit masking.
   -Implemented a numerically clean and transparent computation of relative differences:
      Channels with zero measurement counts are handled safely.
      No NaNs or infinities propagate into averages.
   - Preserved the physical meaning of all consistency and background-comparison checks.

3. Improved consistency checks (measurements & backgrounds)
   - Consistency is now evaluated using:
      Average relative deviation across all channels for each file.
      This approach avoids false warnings from random spikes or isolated noisy channels.
   - Threshold-based warnings are issued only when the average deviation exceeds the user-defined limit, making the test robust and meaningful.
   - The same logic applies independently to measurements and background files.

4. Background vs measurement validation (final result)
   - Added two new physics-informed warning checks when computing final spectra:
      Warning if measurements are less than or equal to background on average.
      Warning if measurements are only slightly above background (below a defined relative margin).
   - These checks operate on summed spectra, not channel-by-channel, preventing over-sensitivity.

5. Live file lists per energy window (bug fix)
   - Fixed an issue where file lists did not update correctly when switching between energy windows.
   - Each energy window now maintains its own independent measurement and background file lists.
   - Switching windows immediately updates the GUI lists to reflect the correct files.

6. GUI usability improvements (file lists)
   - The measurement and background listboxes now display only filenames, not full paths, greatly improving readability.
   - Full paths are still stored internally, so all analysis logic remains unchanged.
   - Added vertical scrollbars to both listboxes for handling many files.
   - Added horizontal scrollbars to both listboxes to support long filenames without truncation.
   - Layout updated to remain compact, readable, and scalable.

7. Plotting safeguards and behavior
   - Removed all pre-selected plot options at startup.
   - Added safeguards:
      Warning if the user attempts to plot without selecting any plot option.
      Warning if plotting is requested for data that has not been loaded (e.g. plotting backgrounds when none exist).
      Ensured plots always reflect the currently selected energy window.

8. Final results display and export
   - Final results are displayed in a structured column format:
      Channel number
      Sum of measurements
      Sum of backgrounds
      Final spectrum (measurement − background)
      Added the ability to save final results to a TXT file, formatted for easy reuse in external analysis software.
