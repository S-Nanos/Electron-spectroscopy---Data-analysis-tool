# Electron Spectroscopy Data Analysis Tool

~~~ Stefanos personal space ~~~

### What's new? 
- [12/12/2025]
  This Python program provides a graphical interface (GUI) to handle and analyze electron counts from multiple measurements and background files. It is designed for datasets where each file contains 256 channels and 3 columns, where:
  Column 1: Channel number
  Column 2: (ignored in calculations)
  Column 3: Electron counts

  Key Features
  1) Energy Windows
      - Users can define multiple energy windows (1 to N).
      - For each window, users can load multiple measurement files and multiple background files.
  2) Channel-wise Summation
      - For each window, the program sums the electron counts per channel across all measurement files and separately across all background files.
      - The final counts are calculated per channel as:
                                    Final counts=Sum of measurements−Sum of backgrounds
  3) Deviation Checking
      - When files are loaded, the program calculates the average counts per channel across all files in that category (measurements or backgrounds).
      - It computes the average deviation of each file from this channel-wise average.
      - If the average deviation exceeds 20%, a warning is displayed.
      - All channels (1–256) are considered, and division by zero is safely avoided.
      - This prevents random spikes in individual channels from triggering false warnings.
  4) GUI Features
      - Input field for specifying energy window number.
      - Buttons for loading measurement files and background files.
      - Button for calculating final summed data.
      - Results are displayed in a scrollable text box, showing channel number, summed measurements, summed backgrounds, and final counts.
  5) File Handling
      - Only .txt files are accepted.
      - Each file must contain exactly 256 channels.
      - The program is robust to missing or malformed files and shows error messages where needed.
  6) Future-proof
      - Uses sep=r'\s+' for reading whitespace-delimited files, compatible with future pandas versions.
      - Safe handling of zero counts to prevent runtime warnings.

- [13/12/2025]
  1) Robust file parsing and stability fixes
     - Fixed a critical parsing issue caused by an incorrectly escaped whitespace separator (r'\\s+' → r'\s+').
     - Explicitly enforced the Python parsing engine in pandas.read_csv to avoid ambiguity with regex separators.
     - Ensured all input TXT files with three columns are read reliably, independent of spacing or tab usage.
     - Eliminated misleading ParserWarning and FutureWarning messages.

  2) Safe numerical handling (division by zero)
     - Removed RuntimeWarning: invalid value encountered in divide by replacing np.where-based logic with explicit masking.
     - Implemented a numerically clean and transparent computation of relative differences:
       Channels with zero measurement counts are handled safely.
       No NaNs or infinities propagate into averages.
     - Preserved the physical meaning of all consistency and background-comparison checks.

  3) Improved consistency checks (measurements & backgrounds)
     - Consistency is now evaluated using:
       Average relative deviation across all channels for each file.
       This approach avoids false warnings from random spikes or isolated noisy channels.
     - Threshold-based warnings are issued only when the average deviation exceeds the user-defined limit, making the test robust and meaningful.
     - The same logic applies independently to measurements and background files.

  4) Background vs measurement validation (final result)
     - Added two new physics-informed warning checks when computing final spectra:
       Warning if measurements are less than or equal to background on average.
       Warning if measurements are only slightly above background (below a defined relative margin).
     - These checks operate on summed spectra, not channel-by-channel, preventing over-sensitivity.

  5) Live file lists per energy window (bug fix)
     - Fixed an issue where file lists did not update correctly when switching between energy windows.
     - Each energy window now maintains its own independent measurement and background file lists.
     - Switching windows immediately updates the GUI lists to reflect the correct files.

  6) GUI usability improvements (file lists)
     - The measurement and background listboxes now display only filenames, not full paths, greatly improving readability.
     - Full paths are still stored internally, so all analysis logic remains unchanged.
     - Added vertical scrollbars to both listboxes for handling many files.
     - Added horizontal scrollbars to both listboxes to support long filenames without truncation.
     - Layout updated to remain compact, readable, and scalable.

  7) Plotting safeguards and behavior
     - Removed all pre-selected plot options at startup.
     - Added safeguards:
       Warning if the user attempts to plot without selecting any plot option.
       Warning if plotting is requested for data that has not been loaded (e.g. plotting backgrounds when none exist).
       Ensured plots always reflect the currently selected energy window.

  8) Final results display and export
     - Final results are displayed in a structured column format:
       Channel number
       Sum of measurements
       Sum of backgrounds
       Final spectrum (measurement − background)
       Added the ability to save final results to a TXT file, formatted for easy reuse in external analysis software.
